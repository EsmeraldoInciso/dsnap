<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DSnap â€” Photo Booth</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“¸</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script>(function(){var t=localStorage.getItem('dsnap_theme');if(!t){t='dark';localStorage.setItem('dsnap_theme','dark')}document.documentElement.setAttribute('data-theme',t)})()</script>
  <script src="https://www.google.com/recaptcha/api.js?render=6Ld0RWgsAAAAABRdIcHVQcVkgAswfd_wb4mluzfY"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@4/dist/fp.min.js"></script>
  <script>var PAGE_TYPE = 'private';</script>
</head>
<body>
  <div class="splash-screen" id="splashScreen"><div class="splash-inner"><div class="splash-logo"><span>D</span><div class="splash-logo-lens"></div></div><div class="splash-title">D<span>Snap</span></div><div class="splash-spinner"></div></div></div>

  <div id="pageContent" style="display:none;">
    <nav class="navbar">
      <a href="./" class="nav-brand"><div class="nav-logo"><span class="nav-logo-letter">D</span><div class="nav-logo-lens"></div></div><div class="nav-wordmark">D<span>Snap</span></div></a>
      <div class="nav-right">
        <a href="./" class="nav-link active"><span class="material-icons-round">camera</span><span class="nav-link-label"> Booth</span></a>
        <a href="gallery/" class="nav-link"><span class="material-icons-round">photo_library</span><span class="nav-link-label"> Gallery</span></a>
        <div class="nav-user">
          <button class="nav-user-btn" onclick="toggleUserMenu()"><div class="nav-avatar" id="navAvatarWrap"><span class="material-icons-round">person</span></div><span class="nav-user-name" id="navUserName"></span></button>
          <div class="nav-dd" id="userDropdown">
            <div class="dd-head"><div class="dd-head-name" id="ddName"></div><div class="dd-head-email" id="ddEmail"></div></div>
            <a href="profile/" class="dd-item"><span class="material-icons-round">person</span> Profile</a>
            <hr class="dd-sep">
            <button class="dd-item" onclick="toggleSettings();closeUserMenu()"><span class="material-icons-round">tune</span> Settings</button>
            <button class="dd-item" onclick="toggleTheme()"><span class="material-icons-round" id="themeIcon">light_mode</span> <span id="themeLabel">Light Mode</span></button>
            <button class="dd-item" onclick="toggleKiosk();closeUserMenu()" id="btnKiosk"><span class="material-icons-round">fullscreen</span> Kiosk Mode</button>
            <hr class="dd-sep">
            <button class="dd-item danger" onclick="handleLogout()"><span class="material-icons-round">logout</span> Sign Out</button>
          </div>
        </div>
      </div>
    </nav>

    <main class="main-content">
      <div class="booth-area">
        <div class="camera-panel">
          <div class="camera-container" id="cameraContainer">
            <video id="video" autoplay playsinline muted></video>
            <div class="countdown-overlay" id="countdownOverlay"><span id="countdownNumber"></span></div>
            <div class="flash-overlay" id="flashOverlay"></div>
            <div class="camera-off" id="cameraOff"><span class="material-icons-round">videocam_off</span><p>Camera is off</p><button class="btn btn-primary" onclick="startCamera()"><span class="material-icons-round">videocam</span> Start Camera</button></div>
            <div class="shot-counter" id="shotCounter"></div>
          </div>
          <div class="camera-controls">
            <button class="ctrl-btn" onclick="flipCamera()" title="Flip"><span class="material-icons-round">flip_camera_ios</span></button>
            <button class="capture-btn" id="btnCapture" onclick="startCapture()" title="Capture"><span class="material-icons-round">camera</span></button>
            <button class="ctrl-btn" onclick="cycleTimer()" title="Timer"><span class="material-icons-round">timer</span><span class="timer-badge" id="timerBadge">OFF</span></button>
          </div>
        </div>
        <div class="preview-panel" id="previewPanel">
          <div class="preview-label"><span class="material-icons-round">preview</span> Live Preview</div>
          <div class="preview-strip-wrap"><canvas id="livePreviewCanvas"></canvas></div>
          <div class="preview-actions" id="previewActions" style="display:none;">
            <button class="btn btn-sm btn-outline" onclick="resetBooth()"><span class="material-icons-round">replay</span> Reset</button>
            <button class="btn btn-sm btn-outline" onclick="downloadPhoto()"><span class="material-icons-round">download</span> Download</button>
            <button class="btn btn-sm btn-outline" onclick="printPhoto()"><span class="material-icons-round">print</span> Print</button>
            <button class="btn btn-sm btn-outline" onclick="showReviewScreen()"><span class="material-icons-round">edit</span> Retake</button>
            <button class="btn btn-sm btn-outline" id="btnViewQR" onclick="showQRModal()" style="display:none;"><span class="material-icons-round">qr_code_2</span> QR</button>
            <button class="btn btn-sm btn-primary" onclick="openEmailModal()"><span class="material-icons-round">email</span> Email</button>
          </div>
          <div class="status-msg" id="statusMsg"></div>
        </div>
      </div>
      <section class="option-section"><h3><span class="material-icons-round">grid_view</span> Layout</h3><div class="option-scroll" id="layoutGrid"></div></section>
      <section class="option-section"><h3><span class="material-icons-round">filter_frames</span> Frame</h3><div class="option-scroll" id="frameGrid"></div></section>
      <section class="option-section"><h3><span class="material-icons-round">auto_awesome</span> Filter</h3><div class="option-scroll" id="filterGrid"></div></section>
    </main>

    <footer class="app-footer">
      <div class="footer-inner">
        <div class="footer-top">
          <div class="footer-brand-col">
            <div class="footer-brand-row"><div class="footer-mark"><span>D</span></div><span class="footer-name">DSnap</span></div>
            <p class="footer-tagline">Every moment, perfectly captured.</p>
          </div>
          <div class="footer-links-col"><h4>Navigate</h4><a href="./">Booth</a><a href="gallery/">Gallery</a><a href="profile/">Profile</a></div>
          <div class="footer-links-col"><h4>App</h4><a href="javascript:void(0)" onclick="toggleSettings()">Settings</a><a href="javascript:void(0)" onclick="toggleTheme()">Toggle Theme</a></div>
        </div>
        <div class="footer-bottom"><span>&copy; 2026 DSnap. Built by Don.</span><span>Powered by Firebase</span></div>
      </div>
    </footer>
  </div>

  <!-- Modals -->
  <div class="modal-backdrop" id="reviewModal"><div class="modal-content review-modal"><div class="modal-header"><h2>Review Photos</h2><button class="icon-btn" onclick="document.getElementById('reviewModal').classList.remove('active')"><span class="material-icons-round">close</span></button></div><div class="modal-body"><p class="modal-desc">Tap <b>Retake</b> on any photo to re-shoot it, or approve all to finalize.</p><div class="review-grid" id="reviewGrid"></div><div class="form-actions" style="margin-top:16px;"><button class="btn btn-outline" onclick="resetBooth()"><span class="material-icons-round">replay</span> Start Over</button><button class="btn btn-primary" onclick="approveAllPhotos()"><span class="material-icons-round">check</span> Approve All</button></div></div></div></div>
  <div class="modal-backdrop" id="emailModal"><div class="modal-content email-modal"><div class="modal-header"><h2>Send Photo</h2><button class="icon-btn" onclick="closeEmailModal()"><span class="material-icons-round">close</span></button></div><div class="modal-body"><p class="modal-desc">Enter your email to receive this photo.</p><div class="form-group"><label>Your Name</label><input type="text" id="recipientName" placeholder="Juan Dela Cruz" maxlength="60"></div><div class="form-group"><label>Your Email</label><input type="email" id="recipientEmail" placeholder="juan@email.com"></div><div class="form-actions"><button class="btn btn-outline" onclick="closeEmailModal()">Cancel</button><button class="btn btn-primary" id="btnSendEmail" onclick="sendEmail()"><span class="material-icons-round">send</span> Send</button></div><div class="email-status" id="emailStatus"></div></div></div></div>
  <div class="modal-backdrop" id="settingsModal"><div class="modal-content settings-modal"><div class="modal-header"><h2>Settings</h2><button class="icon-btn" onclick="toggleSettings()"><span class="material-icons-round">close</span></button></div><div class="settings-body"><div class="setting-row"><label>Mirror Camera</label><label class="switch"><input type="checkbox" id="settingMirror" checked onchange="updateSettings()"><span class="slider"></span></label></div><div class="setting-row"><label>Flash Effect</label><label class="switch"><input type="checkbox" id="settingFlash" checked onchange="updateSettings()"><span class="slider"></span></label></div><div class="setting-row"><label>Shutter Sound</label><label class="switch"><input type="checkbox" id="settingSound" checked onchange="updateSettings()"><span class="slider"></span></label></div><hr class="setting-divider"><h4 class="setting-section-title">Event</h4><div class="setting-row"><label>Title</label><input type="text" id="settingTitle" placeholder="e.g. Wedding" maxlength="50" onchange="updateSettings()"></div><div class="setting-row"><label>Date</label><input type="text" id="settingDate" placeholder="e.g. Feb 14, 2025" maxlength="30" onchange="updateSettings()"></div><hr class="setting-divider"><h4 class="setting-section-title">Features</h4><div class="setting-row"><label>QR Code on Prints</label><label class="switch"><input type="checkbox" id="settingShowQR" checked onchange="updateSettings()"><span class="slider"></span></label></div><div class="setting-row"><label>Auto-save to Gallery</label><label class="switch"><input type="checkbox" id="settingSaveGallery" checked onchange="updateSettings()"><span class="slider"></span></label></div><hr class="setting-divider"><h4 class="setting-section-title">EmailJS</h4><p class="setting-hint"><a href="https://www.emailjs.com/" target="_blank">emailjs.com</a></p><div class="setting-row"><label>Public Key</label><input type="text" id="settingEmailPublicKey" placeholder="Public key" onchange="updateSettings()"></div><div class="setting-row"><label>Service ID</label><input type="text" id="settingEmailServiceId" placeholder="service_xxx" onchange="updateSettings()"></div><div class="setting-row"><label>Template ID</label><input type="text" id="settingEmailTemplateId" placeholder="template_xxx" onchange="updateSettings()"></div></div></div></div>
  <div class="modal-backdrop" id="qrModal"><div class="modal-content" style="max-width:360px;text-align:center;"><div class="modal-header"><h2>Scan to Save</h2><button class="icon-btn" onclick="closeQRModal()"><span class="material-icons-round">close</span></button></div><div class="modal-body" style="padding:24px;"><canvas id="qrModalCanvas" style="width:240px;height:240px;image-rendering:pixelated;margin:0 auto;display:block;border-radius:8px;"></canvas><p id="qrModalUrl" style="font-size:.72rem;color:var(--text-dim);margin-top:12px;word-break:break-all;"></p><p style="font-size:.82rem;color:var(--text);margin-top:8px;">Point your phone camera at this code to view and download your photo.</p></div></div></div>
  <iframe id="printFrame" style="position:absolute;left:-9999px;top:-9999px;width:0;height:0;border:none;"></iframe>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="auth.js"></script>
  <script src="script.js"></script>
  <script>
    function toggleTheme(){var c=document.documentElement.getAttribute('data-theme')||'dark';var n=c==='dark'?'light':'dark';document.documentElement.setAttribute('data-theme',n);localStorage.setItem('dsnap_theme',n);updateThemeUI()}
    function updateThemeUI(){var t=document.documentElement.getAttribute('data-theme')||'dark';var i=document.getElementById('themeIcon');var l=document.getElementById('themeLabel');if(i)i.textContent=t==='dark'?'light_mode':'dark_mode';if(l)l.textContent=t==='dark'?'Light Mode':'Dark Mode'}
    updateThemeUI();
    function toggleUserMenu(){document.getElementById('userDropdown').classList.toggle('open')}
    function closeUserMenu(){document.getElementById('userDropdown').classList.remove('open')}
    document.addEventListener('click',function(e){if(!e.target.closest('.nav-user'))closeUserMenu()});
    function onAuthReady(user){if(!user)return;var name=user.displayName||user.email.split('@')[0];document.getElementById('navUserName').textContent=name;document.getElementById('ddName').textContent=name;document.getElementById('ddEmail').textContent=user.email;var w=document.getElementById('navAvatarWrap');if(user.photoURL)w.innerHTML='<img src="'+user.photoURL+'" alt="">';initPhotoBooth()}
  </script>
</body>
</html>
