<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In â€” Photo Booth</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“¸</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link rel="stylesheet" href="../style.css">
  <script src="https://www.google.com/recaptcha/api.js?render=6Ld0RWgsAAAAABRdIcHVQcVkgAswfd_wb4mluzfY"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@4/dist/fp.min.js"></script>
  <script>var PAGE_TYPE = 'public';</script>
</head>
<body>

  <!-- Page content hidden until auth resolves -->
  <div id="pageContent" style="display:none;">
    <div class="auth-screen">
      <div class="auth-container">
        <div class="auth-logo">
          <span class="material-icons-round">photo_camera</span>
        </div>
        <h1 class="auth-title">Photo Booth</h1>
        <p class="auth-subtitle">Sign in to start capturing memories</p>

        <!-- Tabs -->
        <div class="auth-tabs">
          <button class="auth-tab active" id="tabLogin" onclick="switchTab('login')">Sign In</button>
          <button class="auth-tab" id="tabSignup" onclick="switchTab('signup')">Sign Up</button>
        </div>

        <!-- Login -->
        <div id="loginForm" class="auth-form">
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="loginEmail" placeholder="you@email.com" autocomplete="email">
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="loginPassword" placeholder="Your password" autocomplete="current-password">
          </div>
          <button class="btn btn-primary btn-full" id="btnLogin" onclick="doLogin()">
            <span class="material-icons-round">login</span> Sign In
          </button>
        </div>

        <!-- Signup -->
        <div id="signupForm" class="auth-form" style="display:none;">
          <div class="form-group">
            <label>Display Name</label>
            <input type="text" id="signupName" placeholder="Your name" maxlength="40" autocomplete="name">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="signupEmail" placeholder="you@email.com" autocomplete="email">
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="signupPassword" placeholder="At least 6 characters" autocomplete="new-password">
          </div>
          <div class="form-group">
            <label>Confirm Password</label>
            <input type="password" id="signupConfirm" placeholder="Confirm password" autocomplete="new-password">
          </div>
          <button class="btn btn-primary btn-full" id="btnSignup" onclick="doSignup()">
            <span class="material-icons-round">person_add</span> Create Account
          </button>
        </div>

        <!-- Divider -->
        <div class="auth-divider"><span>or</span></div>

        <!-- Google -->
        <button class="btn btn-google btn-full" id="btnGoogle" onclick="doGoogle()">
          <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
          Continue with Google
        </button>

        <div class="auth-status" id="authStatus"></div>
        <p class="recaptcha-note">Protected by reCAPTCHA v3</p>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="../auth.js"></script>

  <script>
    // â”€â”€ Login Page Logic â”€â”€

    function switchTab(tab) {
      document.getElementById('tabLogin').classList.toggle('active', tab === 'login');
      document.getElementById('tabSignup').classList.toggle('active', tab === 'signup');
      document.getElementById('loginForm').style.display = tab === 'login' ? 'block' : 'none';
      document.getElementById('signupForm').style.display = tab === 'signup' ? 'block' : 'none';
      clearStatus();
    }

    function showStatus(msg, isErr) {
      var el = document.getElementById('authStatus');
      el.textContent = msg;
      el.className = 'auth-status ' + (isErr ? 'error' : 'success');
    }

    function clearStatus() {
      var el = document.getElementById('authStatus');
      el.textContent = '';
      el.className = 'auth-status';
    }

    function setLoading(on) {
      ['btnLogin','btnSignup','btnGoogle'].forEach(function(id) {
        var b = document.getElementById(id);
        if (b) { b.disabled = on; b.style.opacity = on ? '0.6' : '1'; }
      });
    }

    function doLogin() {
      var email = document.getElementById('loginEmail').value.trim();
      var pw = document.getElementById('loginPassword').value;
      if (!email || !pw) { showStatus('Please enter email and password.', true); return; }
      setLoading(true); clearStatus();
      handleLogin(email, pw).catch(function(err) {
        showStatus(friendlyAuthError(err), true);
        setLoading(false);
      });
    }

    function doSignup() {
      var name = document.getElementById('signupName').value.trim();
      var email = document.getElementById('signupEmail').value.trim();
      var pw = document.getElementById('signupPassword').value;
      var confirm = document.getElementById('signupConfirm').value;
      if (!name) { showStatus('Please enter your name.', true); return; }
      if (!email) { showStatus('Please enter your email.', true); return; }
      if (pw.length < 6) { showStatus('Password must be at least 6 characters.', true); return; }
      if (pw !== confirm) { showStatus('Passwords do not match.', true); return; }
      setLoading(true); clearStatus();
      handleSignup(name, email, pw).catch(function(err) {
        showStatus(friendlyAuthError(err), true);
        setLoading(false);
      });
    }

    function doGoogle() {
      setLoading(true); clearStatus();
      handleGoogleLogin().catch(function(err) {
        var msg = friendlyAuthError(err);
        if (msg) showStatus(msg, true);
        setLoading(false);
      });
    }

    // Enter key support
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('loginPassword').addEventListener('keydown', function(e) { if (e.key === 'Enter') doLogin(); });
      document.getElementById('signupConfirm').addEventListener('keydown', function(e) { if (e.key === 'Enter') doSignup(); });
    });
  </script>
</body>
</html>
