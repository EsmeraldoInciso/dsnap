<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In â€” DSnap</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“¸</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link rel="stylesheet" href="../style.css">
  <script>(function(){var t=localStorage.getItem('dsnap_theme');if(!t){t='dark';localStorage.setItem('dsnap_theme','dark')}document.documentElement.setAttribute('data-theme',t)})()</script>
  <script src="https://www.google.com/recaptcha/api.js?render=6Ld0RWgsAAAAABRdIcHVQcVkgAswfd_wb4mluzfY"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@4/dist/fp.min.js"></script>
  <script>var PAGE_TYPE = 'public';</script>
  <style>
    .auth-split{flex-direction:row;gap:0;padding:0}
    .auth-hero{display:flex;align-items:center;justify-content:center;flex:1;padding:48px;background:linear-gradient(135deg,rgba(37,99,235,0.12) 0%,rgba(6,182,212,0.08) 100%);min-height:100vh;flex-basis:0}
    .auth-hero-inner{max-width:380px;text-align:center;display:flex;flex-direction:column;align-items:center}
    .auth-hero-logo{margin-bottom:12px;display:flex}.auth-hero-logo .nav-logo{width:56px;height:56px;border-radius:14px}.auth-hero-logo .nav-logo-letter{font-size:30px}.auth-hero-logo .nav-logo-lens{top:7px;right:7px;width:11px;height:11px;border-width:2px}
    .auth-hero-title{font-family:var(--font-d);font-size:2rem;font-weight:800;color:var(--text);letter-spacing:-0.03em;margin-bottom:4px}
    .auth-hero-title span{background:linear-gradient(135deg,var(--primary-light),var(--accent-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .auth-hero-tagline{color:var(--text-secondary);font-size:1.1rem;margin-bottom:32px}
    .auth-hero-features{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:20px}
    .auth-hero-features li{display:flex;align-items:flex-start;gap:14px;color:var(--text);text-align:left}
    .auth-hero-features li>.material-icons-round{font-size:28px;color:var(--primary-light);flex-shrink:0;margin-top:2px}
    .auth-hero-features li div{display:flex;flex-direction:column;gap:2px}
    .auth-hero-features li strong{font-size:0.95rem;font-weight:600}
    .auth-hero-features li span{font-size:0.85rem;color:var(--text-secondary);line-height:1.4}
    .auth-split>.auth-container,.auth-split>#verifyPanel{flex:1;flex-basis:0;border:none;border-radius:0;min-height:100vh;max-width:none;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:36px 40px;border-left:1px solid var(--border)}
    .auth-split>.auth-container>*,.auth-split>#verifyPanel>*{width:100%;max-width:400px}
    .auth-card-header{display:none}
    @media(max-width:860px){
      .auth-card-header{display:block;text-align:center;margin-bottom:8px}
      .auth-split{flex-direction:column;padding:20px}
      .auth-hero{display:none}
      .auth-split>.auth-container,.auth-split>#verifyPanel{min-height:auto;border-left:none;border:1px solid var(--border);border-radius:var(--r);padding:36px 32px}
    }
  </style>
</head>
<body>
  <div class="splash-screen" id="splashScreen"><div class="splash-inner"><div class="splash-logo"><span>D</span><div class="splash-logo-lens"></div></div><div class="splash-title">D<span>Snap</span></div><div class="splash-spinner"></div></div></div>

  <div id="pageContent" style="display:none;">
    <div class="auth-screen auth-split">
      <div class="auth-hero">
        <div class="auth-hero-inner">
          <div class="auth-hero-logo"><div class="nav-logo"><span class="nav-logo-letter">D</span><div class="nav-logo-lens"></div></div></div>
          <h2 class="auth-hero-title">D<span>Snap</span></h2>
          <p class="auth-hero-tagline">Your photo booth, reimagined.</p>
          <ul class="auth-hero-features">
            <li><span class="material-icons-round">photo_camera</span><div><strong>Capture Moments</strong><span>Snap stunning photos with real-time filters and effects</span></div></li>
            <li><span class="material-icons-round">collections</span><div><strong>Beautiful Galleries</strong><span>Browse and relive your memories in a sleek gallery</span></div></li>
            <li><span class="material-icons-round">share</span><div><strong>Share Instantly</strong><span>Download or share your photos with one tap</span></div></li>
            <li><span class="material-icons-round">group</span><div><strong>Events Made Easy</strong><span>Perfect for parties, weddings, and celebrations</span></div></li>
          </ul>
        </div>
      </div>
      <div class="auth-container">
        <div class="auth-card-header">
          <div class="auth-logo"><div class="nav-logo"><span class="nav-logo-letter">D</span><div class="nav-logo-lens"></div></div></div>
          <h1 class="auth-title">D<span>Snap</span></h1>
          <p class="auth-subtitle">Every moment, perfectly captured</p>
        </div>
        <div class="auth-tabs">
          <button class="auth-tab active" id="tabLogin" onclick="showTab('login')">Sign In</button>
          <button class="auth-tab" id="tabSignup" onclick="showTab('signup')">Sign Up</button>
        </div>

        <div id="loginForm" class="auth-form">
          <div class="form-group"><label>Email</label><input type="email" id="loginEmail" placeholder="you@email.com"></div>
          <div class="form-group"><label>Password</label><input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
          <button class="btn btn-primary btn-full" onclick="doLogin()"><span class="material-icons-round">login</span> Sign In</button>
        </div>

        <div id="signupForm" class="auth-form" style="display:none;">
          <div class="form-group"><label>Name</label><input type="text" id="signupName" placeholder="Your name" maxlength="40"></div>
          <div class="form-group"><label>Email</label><input type="email" id="signupEmail" placeholder="you@email.com"></div>
          <div class="form-group"><label>Password</label><input type="password" id="signupPassword" placeholder="Min 6 characters"></div>
          <button class="btn btn-primary btn-full" onclick="doSignup()"><span class="material-icons-round">person_add</span> Create Account</button>
        </div>

        <div class="auth-divider"><span>or</span></div>
        <button class="btn btn-google btn-full" onclick="handleGoogleLogin()">
          <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.6 20.1H42V20H24v8h11.3C33.9 33.6 29.3 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3.1 0 5.8 1.2 8 3l5.7-5.7C34 6 29.2 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 20-8.9 20-20c0-1.3-.2-2.7-.4-3.9z"/><path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.5 15.5 18.8 12 24 12c3.1 0 5.8 1.2 8 3l5.7-5.7C34 6 29.2 4 24 4 16.3 4 9.7 8.3 6.3 14.7z"/><path fill="#4CAF50" d="M24 44c5 0 9.5-1.8 13-4.7l-6-5c-2 1.5-4.5 2.5-7 2.5-5.2 0-9.6-3.5-11.2-8.2l-6.5 5C9.5 39.6 16.2 44 24 44z"/><path fill="#1976D2" d="M43.6 20.1H42V20H24v8h11.3c-.8 2.2-2.2 4.1-4 5.4l6 5c-.4.4 6.7-4.9 6.7-14.4 0-1.3-.2-2.7-.4-3.9z"/></svg>
          Continue with Google
        </button>

        <div class="auth-status" id="authStatus"></div>
        <p class="recaptcha-note">Protected by reCAPTCHA</p>
      </div>

      <!-- Email Verification Panel -->
      <div class="auth-container" id="verifyPanel" style="display:none;">
        <div class="auth-logo"><div class="nav-logo"><span class="nav-logo-letter">D</span><div class="nav-logo-lens"></div></div></div>
        <h1 class="auth-title">Verify Your Email</h1>
        <p class="auth-subtitle" id="verifyMsg">We sent a verification link to your email. Click the link to verify, then come back.</p>
        <div style="display:flex; flex-direction:column; gap:12px; margin-top:20px;">
          <button class="btn btn-primary btn-full" onclick="doCheckVerified()"><span class="material-icons-round">check_circle</span> I've Verified â€” Continue</button>
          <button class="btn btn-full" onclick="doResend()" id="resendBtn"><span class="material-icons-round">email</span> Resend Email</button>
          <button class="btn btn-full" onclick="handleLogout()" style="opacity:0.7;"><span class="material-icons-round">logout</span> Sign Out</button>
        </div>
        <div class="auth-status" id="verifyStatus"></div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="../auth.js"></script>
  <script>
    function showTab(tab) {
      document.getElementById('loginForm').style.display = tab === 'login' ? 'flex' : 'none';
      document.getElementById('signupForm').style.display = tab === 'signup' ? 'flex' : 'none';
      document.getElementById('tabLogin').className = 'auth-tab' + (tab === 'login' ? ' active' : '');
      document.getElementById('tabSignup').className = 'auth-tab' + (tab === 'signup' ? ' active' : '');
      document.getElementById('authStatus').textContent = '';
    }

    function showVerifyPanel(email) {
      document.querySelector('.auth-container').style.display = 'none';
      var panel = document.getElementById('verifyPanel');
      panel.style.display = 'block';
      if (email) {
        document.getElementById('verifyMsg').textContent = 'We sent a verification link to ' + email + '. Click the link to verify, then come back.';
      }
    }

    function doLogin() {
      var e = document.getElementById('loginEmail').value.trim();
      var p = document.getElementById('loginPassword').value;
      var s = document.getElementById('authStatus');
      if (!e || !p) { s.textContent = 'Fill in all fields.'; s.className = 'auth-status error'; return; }
      s.textContent = 'Signing in...'; s.className = 'auth-status';
      handleLogin(e, p).catch(function(err) { s.textContent = friendlyAuthError(err); s.className = 'auth-status error'; });
    }

    function doSignup() {
      var n = document.getElementById('signupName').value.trim();
      var e = document.getElementById('signupEmail').value.trim();
      var p = document.getElementById('signupPassword').value;
      var s = document.getElementById('authStatus');
      if (!n || !e || !p) { s.textContent = 'Fill in all fields.'; s.className = 'auth-status error'; return; }
      if (p.length < 6) { s.textContent = 'Password must be 6+ characters.'; s.className = 'auth-status error'; return; }
      s.textContent = 'Creating account...'; s.className = 'auth-status';
      handleSignup(n, e, p).then(function() {
        showVerifyPanel(e);
      }).catch(function(err) { s.textContent = friendlyAuthError(err); s.className = 'auth-status error'; });
    }

    function doCheckVerified() {
      var s = document.getElementById('verifyStatus');
      s.textContent = 'Checking...'; s.className = 'auth-status';
      auth.currentUser.reload().then(function() {
        if (auth.currentUser.emailVerified) {
          s.textContent = 'Verified!'; s.className = 'auth-status';
          window.location.replace(appUrl(''));
        } else {
          s.textContent = 'Email not verified yet. Check your inbox and click the link.'; s.className = 'auth-status error';
        }
      }).catch(function() {
        s.textContent = 'Could not check. Try again.'; s.className = 'auth-status error';
      });
    }

    function doResend() {
      var s = document.getElementById('verifyStatus');
      var btn = document.getElementById('resendBtn');
      btn.disabled = true;
      s.textContent = 'Sending...'; s.className = 'auth-status';
      handleResendVerification().then(function() {
        s.textContent = 'Verification email sent!'; s.className = 'auth-status';
        setTimeout(function() { btn.disabled = false; }, 30000);
      }).catch(function(err) {
        s.textContent = friendlyAuthError(err); s.className = 'auth-status error';
        btn.disabled = false;
      });
    }

    function onAuthReady(user) {
      // If user is logged in but unverified and on ?verify=1, show verify panel
      if (user && !user.emailVerified && window.location.search.indexOf('verify=1') !== -1) {
        var isGoogle = user.providerData.length > 0 && user.providerData[0].providerId === 'google.com';
        if (!isGoogle) {
          showVerifyPanel(user.email);
        }
      }
    }
  </script>
</body>
</html>
